% d20 System (3.5) Book
% Caio Freitas de Oliveira

\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesClass{d20book}
              [2020/06/05 v0.1
 d20 System LaTeX document class]

\DeclareOption{onecolumn}{\@twocolumnfalse}
\DeclareOption{twocolumn}{\@twocolumntrue}
\DeclareOption{oneside}{\@twosidefalse}
\DeclareOption{twoside}{\@twosidetrue}
\ExecuteOptions{twocolumn,twoside}
\ProcessOptions
\if@twocolumn
	\if@twoside
	\LoadClass[8pt,utf8x,a4paper,final,twocolumn,openany,twoside]{extbook}
	\else
	\LoadClass[8pt,utf8x,a4paper,final,twocolumn,openany,oneside]{extbook}
	\fi
\else
	\if@twoside
	\LoadClass[8pt,utf8x,a4paper,final,onecolumn,openany,twoside]{extbook}
	\else
	\LoadClass[8pt,utf8x,a4paper,final,onecolumn,openany,oneside]{extbook}
	\fi
\fi

\if@twoside
\RequirePackage[outer=2.5cm,inner=2cm,top=2cm,bottom=2.5cm,asymmetric,twoside]{geometry}
\else
\RequirePackage[left=2cm,right=2cm,top=2.5cm,bottom=3cm]{geometry}
\fi


\RequirePackage{cuted,stfloats}
\RequirePackage{setspace}
\RequirePackage{lettrine}
\RequirePackage{tabularx,booktabs}
\RequirePackage{imfellEnglish}
\RequirePackage[table]{xcolor}
\RequirePackage[outline]{contour}
\RequirePackage[titletoc]{appendix}

% #####  Color Palette by Paletton.com
% #####  Palette URL: http://paletton.com/#uid=6060u0kvlhX8XuSn+ozNxau+L1g
%
% *** Primary color:
%    shade 0 = #8F1603 = rgb(143, 22,  3) = rgba(143, 22,  3,1) = rgb0(0.561,0.086,0.012)
%    shade 1 = #F6BBB1 = rgb(246,187,177) = rgba(246,187,177,1) = rgb0(0.965,0.733,0.694)
%    shade 2 = #C44531 = rgb(196, 69, 49) = rgba(196, 69, 49,1) = rgb0(0.769,0.271,0.192)
%    shade 3 = #530B00 = rgb( 83, 11,  0) = rgba( 83, 11,  0,1) = rgb0(0.325,0.043,0)
%    shade 4 = #0A0100 = rgb( 10,  1,  0) = rgba( 10,  1,  0,1) = rgb0(0.039,0.004,0)
%
% *** Secondary color (1):
%    shade 0 = #8F4A03 = rgb(143, 74,  3) = rgba(143, 74,  3,1) = rgb0(0.561,0.29,0.012)
%    shade 1 = #F6D4B1 = rgb(246,212,177) = rgba(246,212,177,1) = rgb0(0.965,0.831,0.694)
%    shade 2 = #C47B31 = rgb(196,123, 49) = rgba(196,123, 49,1) = rgb0(0.769,0.482,0.192)
%    shade 3 = #532A00 = rgb( 83, 42,  0) = rgba( 83, 42,  0,1) = rgb0(0.325,0.165,0)
%    shade 4 = #0A0500 = rgb( 10,  5,  0) = rgba( 10,  5,  0,1) = rgb0(0.039,0.02,0)
%
% *** Secondary color (2):
%    shade 0 = #780338 = rgb(120,  3, 56) = rgba(120,  3, 56,1) = rgb0(0.471,0.012,0.22)
%    shade 1 = #CF95AF = rgb(207,149,175) = rgba(207,149,175,1) = rgb0(0.812,0.584,0.686)
%    shade 2 = #A42961 = rgb(164, 41, 97) = rgba(164, 41, 97,1) = rgb0(0.643,0.161,0.38)
%    shade 3 = #460020 = rgb( 70,  0, 32) = rgba( 70,  0, 32,1) = rgb0(0.275,0,0.125)
%    shade 4 = #080004 = rgb(  8,  0,  4) = rgba(  8,  0,  4,1) = rgb0(0.031,0,0.016)
%
% *** Complement color:
%    shade 0 = #026A22 = rgb(  2,106, 34) = rgba(  2,106, 34,1) = rgb0(0.008,0.416,0.133)
%    shade 1 = #83B692 = rgb(131,182,146) = rgba(131,182,146,1) = rgb0(0.514,0.714,0.573)
%    shade 2 = #249145 = rgb( 36,145, 69) = rgba( 36,145, 69,1) = rgb0(0.141,0.569,0.271)
%    shade 3 = #003E13 = rgb(  0, 62, 19) = rgba(  0, 62, 19,1) = rgb0(0,0.243,0.075)
%    shade 4 = #000702 = rgb(  0,  7,  2) = rgba(  0,  7,  2,1) = rgb0(0,0.027,0.008)
% #####  Generated by Paletton.com (c) 2002-2014

\definecolor{LinkColor}{HTML}{003E13} %complement
\definecolor{TableColor}{HTML}{F6BBB1} %primary #1
% \definecolor{SubsectionColor}{HTML}{F6D4B1} %secondary #2
\definecolor{SubsectionColor}{HTML}{C44531} %primary #2
\definecolor{ChapterColor}{HTML}{8F1603} %primary #0

% Font settings
\renewcommand*\rmdefault{lmr}

% \newcommand\fixsize{\fontsize{\f@size*1.05pt}{\f@size*1.01pt}}
\newcommand\fixsize{}
\newcommand\textold[1]{{\imfellEnglish\itshape #1}}
\newcommand\tableheader{\imfellEnglish\scshape\fixsize}
\newcommand\bold[1]{{\fontseries{bx}\selectfont #1}}
\renewcommand\bfseries{\imfellEnglish\scshape}
\renewcommand\textbf[1]{{\fixsize\bfseries #1}}
\renewcommand\textit[1]{{\slshape\imfellEnglish #1}}

% References
\newcommand{\class}[1]{\hyperref[class:#1]{#1}}
\newcommand{\skill}[1]{\hyperref[skill:#1]{#1}}
\newcommand{\feat}[1]{\hyperref[feat:#1]{#1}}
\newcommand{\spell}[1]{\spellref{#1}{#1}}
\newcommand{\spellref}[2]{\emph{\hyperref[spell:#1]{#2}}}
\newcommand{\spellList}[1]{\noindent\textit{\hyperref[spell:#1]{#1}}}
\newcommand{\psionic}[1]{\emph{\hyperref[psionic:#1]{#1}}}
\newcommand{\psionicList}[1]{\noindent\textit{\hyperref[psionic:#1]{#1}}}
\newcommand{\magicitem}[1]{\emph{\hyperref[magicitem:#1]{#1}}}
\newcommand{\psionicitem}[1]{\emph{\hyperref[psionicitem:#1]{#1}}}
\newcommand{\tabref}[1]{\hyperref[tab:#1]{Table: #1}}
\newcommand{\chapref}[1]{\hyperref[chapter:#1]{Chapter: #1}}
\newcommand{\apxref}[1]{\hyperref[apx:#1]{Appendix: #1}}


% Table of Contents
\renewcommand\tableofcontents{
	{
		\imfellEnglish
		\parskip=0em
		\chapter*{\contentsname}
		
		\@mkboth{\MakeUppercase\contentsname}{\MakeUppercase\contentsname}
		\@starttoc{toc}
	}
}
\setcounter{tocdepth}{2}
\renewcommand\listoftables{%
	{
		\imfellEnglish
		\parskip=0em
		\chapter*{\listtablename}%
		\@mkboth{\MakeUppercase\listtablename}{\MakeUppercase\listtablename}%
		\@starttoc{lot}%
	}
}

\newcommand{\cbold}[2][black]{
	\contourlength{0.001pt}\contournumber{1}\contour{#1}{#2}
}
% Chapter Name
\def\@makechapterhead#1{%
	{
		\imfellEnglish%
		\begin{tabular}{p{25mm}r{\textwidth-25mm}}
		\ifnum \c@secnumdepth >\m@ne%
			\if@mainmatter%
				\fontsize{}{}\@chapapp\space\thechapter%
			\fi%
		\fi%
		&
		\fontsize{25pt}{25pt}\bfseries\color{ChapterColor}\raggedleft{
			\contourlength{0.2pt}\contournumber{10}\contour{ChapterColor}{
				\MakeUppercase{#1}
			}
		}
		\end{tabular}
	}
}
% Caption
\long\def\@makecaption#1#2{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{\large\imfellEnglish#1: #2}%
  \ifdim \wd\@tempboxa >\hsize
    \large\imfellEnglish #1: #2\par
  \else
    \global \@minipagefalse
    \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}

% Add quotes
\newcommand{\Quote}[3][0em]{
	\noindent\parbox[c]{\linewidth}
	{
		\imfellEnglish\slshape
		\linespread{.9}
		{
			\color{black!50}
			\setlength\parindent{5pt}
			``#2''

		}
		\ifx&#3&\else{\hfill\color{black!50}--- #3}\fi
		\vskip.5em
	}
}
\newcommand{\Chapter}[3]{
	\chapter{#1}
	\label{chapter:#1}
	\begin{strip}
	\Quote{#2}{#3}
	\end{strip}
}

% Captilize
\newcommand{\Capitalize}[2]{\lettrine[lines=4]{#1}{#2}}
% Items
\newenvironment{itemize*}%
  {\begin{itemize}%
    \setlength{\itemsep}{0.15em}%
    \setlength{\parskip}{0em}}%
  {\end{itemize}}
\newenvironment{enumerate*}%
  {\begin{enumerate}%
    \setlength{\itemsep}{0.15em}%
    \setlength{\parskip}{0em}}%
  {\end{enumerate}}
% Different sections
\renewcommand\section{
	\@startsection{section}
	{1}
	{0pt}{1em}{0.01em}{\raggedleft\color{ChapterColor}\fontsize{17.3pt}{17.3pt}\scshape\imfellEnglish}}
\renewcommand\subsection{\@startsection{subsection}%
	{2}%
	{0pt}{.7em}{0.01em}{\color{ChapterColor}\fontsize{14.4pt}{14.4pt}\scshape\imfellEnglish}*}
\newcommand\subsectionA{\@startsection{subsection}%
	{2}%
	{0pt}{.7em}{0.01em}{\color{ChapterColor}\fontsize{14.4pt}{14.4pt}\scshape\imfellEnglish}}
\renewcommand\subsubsection{\@startsection{subsubsection}{3}{0pt}{.7em}{0.01em}{\color{SubsectionColor}\fontsize{12pt}{12pt}\imfellEnglish}*}
\newcommand{\Class}[4][\section]{
	#1{#2}\label{class:#2}
	\Quote{#3}{#4}
}
\newcommand{\Skill}[2]{\subsectionA[#1]{#1 \LARGE(#2)} \label{skill:#1}}
\newcommand{\Feat}[7][General]{
	\subsubsection{#2 \large[#1]} \label{feat:#2}
	#3

	\ifx&#4&\else\textbf{Prerequisites:} #4

	\fi
	\ifx&#5&\else\textbf{Benefit:} #5

	\fi
	\ifx&#6&\else\textbf{Normal:} #6

	\fi
	\ifx&#7&\else\textbf{Special:} #7

	\fi
}
\newcommand{\GFeat}[4][General]{\Feat[#1]{#2}{}{#3}{#4}{}{}}
\newcommand{\PrestigeClass}[1][\section]{
	\def\PCsection{#1}
	\PrestigeClassHeader
}
\newcommand{\PrestigeClassHeader}[8][\subsection]{
	\Class[\PCsection]{#2}{#3}{#4}

	#5

	\textbf{Hit Die:} #6.

	#1{Becoming #7 #2}
	#8
	\PrestigeClassRules{#1}{#2}{#7}
}
\newcommand{\PrestigeClassRules}[9]{
	#7{The #2}{#8}

	#1{Entry Requirements}
	\noindent To qualify to become #3 \lowercase{#2}, a character must fufill all the following criteria.

	#4
	#1{Class Skills}
	#5

	\textbf{Skill Points per Level:} #6 + Int modifier.
	
	#1{Class Features}
	#9
	% \PrestigeClassLore{#2}
}
\newcommand{\PrestigeClassLore}[6]{
	\subsection{#1 Lore}
	\ifx&#2&
	Characters with ranks in \skill{Knowledge} (#3) can research \lowercase{#1}s to learn more about them. When a character makes a skill check, read or paraphrase the following, including the information from lower DCs.
	\else
	Characters with ranks in \skill{Knowledge} (#3) can research #2 to learn more about them. When a character makes a skill check, read or paraphrase the following, including the information from lower DCs.
	\fi

	\textbf{DC 15:} #4

	\textbf{DC 20:} #5

	\textbf{DC 30:} #6
}
\newcommand{\City}[5]{
	\section{#1}
	\textbf{Population:} #2

	\textbf{Exports:} #3

	\textbf{Languages:} #4

	#5

	\CityDescription
}
\newcommand{\SubCity}[5]{
	\subsectionA{#1}
	\textbf{Population:} #2

	\textbf{Exports:} #3

	\textbf{Languages:} #4

	#5

	\CityDescription[\subsubsection]
}
\newcommand{\CityDescription}[7][\subsection]{
	#1{Life and Society}
	#2
	#1{Government and Politics}
	#3
	#1{Power Groups}
	#4
	\ifx&#5&\else
	#1{Major Settlements}
	#5
	\fi

	\ifx&#6&\else
	#1{Important Sites}
	#6
	\fi
	#1{Adventure Ideas}
	\begin{itemize*}
	#7
	\end{itemize*}
}
\newcommand{\AlternateClassFeature}[6]{
	\subsubsection{#1}
	#2

	\ifx&#3&\else\textbf{Special Requirements:} #3

	\fi
	\textbf{Level:} #4

	\textbf{Replaces:} #5

	\textbf{Benefit:} #6
}
\newcommand{\Domain}[4]{
	\subsection{#1 Domain}
	\ifx&#2&\else\textbf{Patron:} #2.

	\fi
	\textbf{Granted Power:} #3


	\subsubsection{#1 Domain Spells}
	\begin{enumerate*}
		#4
	\end{enumerate*}
}
\newcommand{\Spell}{
	\PowerDescription{spell}
}
\newcommand{\Psionic}{
	\PowerDescription{psionic}
}
\newcommand{\PowerDescription}[6]{
	\subsection{#2}
	\label{#1:#2}
	\label{#1:#3}
	{
		{
			\setlength\parindent{0pt}
			#4\\
			#5
		}
		\\
		{
			\noindent #6
		}
	}
}
\newcommand{\MonsterStatsA}[9][]{
	\ifx&#1&\else\textbf{#1}

	\fi
	\textbf{#2}

	\textbf{Hit Dice:} #3

	\textbf{Initiative:} #4

	\textbf{Speed:} #5

	\textbf{Armor Class:} #6

	\textbf{Base Attack/Grapple:} #7

	\textbf{Attack:} #8

	\textbf{Full Attack:} #9

	\MonsterStatsB
}
\newcommand{\MonsterStatsB}[7]{
	\textbf{Space/Reach:} #1

	\textbf{Special Attacks:} #2

	\textbf{Special Qualities:} #3

	\textbf{Saves:} #4

	\textbf{Abilities:} #5

	\textbf{Skills:} #6

	\textbf{Feats:} #7

	\MonsterStatsC
}
\newcommand{\MonsterStatsC}[7]{
	\textbf{Environment:} #1

	\textbf{Organization:} #2

	\textbf{Challenge Rating:} #3

	\textbf{Treasure:} #4

	\textbf{Alignment:} #5

	\textbf{Advancement:} #6

	\textbf{Level Adjustment:} #7

	\vskip.3em
}
\newenvironment{MonsterStats}
{
	\parskip.2mm
	\leftskip2.5mm
	\parindent-2.5mm
	\setstretch{1}
	% \small
	\MonsterStatsA
}
{
}

% NPC functions

% Table commands
%% Column types
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}
\newcolumntype{L}{>{\raggedright\arraybackslash}X}
\newcolumntype{Z}[1]{>{\centering\arraybackslash}b{#1}}
\newcolumntype{r}[1]{>{\raggedleft\arraybackslash}b{#1}}
\newcolumntype{y}[1]{>{\raggedright\arraybackslash}b{#1}}
\newcolumntype{Y}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{z}[1]{>{\centering\arraybackslash}p{#1}}

\newcommand{\TableNote}[2]{
\rowcolor{white}\multicolumn{#1}{p{\columnwidth-1em}}{#2}
}

\newcommand{\BigTableNote}[2]{
\rowcolor{white}\multicolumn{#1}{p{\textwidth-1em}}{#2}
}

%% Tables
\newcommand{\TinyTable}[4][\columnwidth]{
	\ifx&#2&\else\begin{table}[h!]\fi
	\ifx&#2&\else\caption{\label{tab:#2}#2}\fi
	\begin{tabularx}{#1}{@{}#3@{}}\rowcolors{2}{}{TableColor}\tiny
	#4\end{tabularx}
	\ifx&#2&\else\end{table}\fi
}
\newcommand{\TransparentTable}[4][\small]{
	\ifx&#2&{\noindent\else\begin{table}[h!]\caption{\label{tab:#2}#2}\fi
	#1
	\begin{tabularx}{\columnwidth}{@{}#3@{}}
	#4\end{tabularx}
	\ifx&#2&}\else\end{table}\fi
}
\newcommand{\Table}[4][\small]{
	\ifx&#2&{\noindent\else\begin{table}[h!]\caption{\label{tab:#2}#2}\fi
	#1
	\rowcolors{2}{}{TableColor}
	\begin{tabularx}{\columnwidth}{@{}#3@{}}
	#4\end{tabularx}
	\ifx&#2&}\else\end{table}\fi
}
\newcommand{\TableOdd}[4][\small]{
	\ifx&#2&{\noindent\else\begin{table}[h!]\caption{\label{tab:#2}#2}\fi
	#1
	\rowcolors{2}{TableColor}{}
	\begin{tabularx}{\columnwidth}{@{}#3@{}}
	#4\end{tabularx}
	\ifx&#2&}\else\end{table}\fi
}
\newcommand{\BigTable}[3]{
	\begin{table*}[h!]
	\rowcolors{0}{TableColor}{}
	\small
	\ifx&#1&\else\caption{\label{tab:#1}#1}\fi
	\begin{tabularx}{\textwidth}{#2}#3\end{tabularx}
	\end{table*}
}
\newcommand{\BigTablePair}[3]{
	\begin{table*}[b!]
	\rowcolors{0}{}{TableColor}
	\small
	\ifx&#1&\else\caption{\label{tab:#1}#1}\fi
	\begin{tabularx}{\textwidth}{#2}#3\end{tabularx}
	\end{table*}
}
\newcommand{\Cell}[2][c]{
	\begin{tabular}{@{}#1@{}}
		#2
	\end{tabular}
}
\newcommand{\WarriorTable}[3][ll *{3}{Z{14mm}} L]{
	\BigTablePair{#2}{#1}{
		  \tableheader Level
		& \tableheader Base Attack Bonus
		& \tableheader Fort Save
		& \tableheader Ref Save
		& \tableheader Will Save
		& \tableheader Special\\
		#3
	}
}

\newcommand{\PrestigeSpellTable}[3][l b{16mm} *{3}{Z{5mm}} L l]{
	\BigTablePair{#2}{#1}{
		  \tableheader Level
		& \tableheader Base \hskip3em Attack Bonus
		& \tableheader Fort Save
		& \tableheader Ref Save
		& \tableheader Will Save
		& \tableheader Special
		& \tableheader Spellcasting\\
		#3
	}
}

\newcommand{\PrestigeOnlySpellTable}[3][l b{16mm} *{3}{Z{5mm}} X]{
	\BigTablePair{#2}{#1}{
		  \tableheader Level
		& \tableheader Base \hskip3em Attack Bonus
		& \tableheader Fort Save
		& \tableheader Ref Save
		& \tableheader Will Save
		& \tableheader Spellcasting\\
		#3
	}
}

\newcommand{\PrestigePowerTable}[3][l b{16mm} *{3}{Z{5mm}} L l]{
	\BigTablePair{#2}{#1}{
		  \tableheader Level
		& \tableheader Base \hskip3em Attack Bonus
		& \tableheader Fort Save
		& \tableheader Ref Save
		& \tableheader Will Save
		& \tableheader Special
		& \tableheader Manifesting\\
		#3
	}
}

\newcommand{\MiniWarriorTable}[3][l l *{3}{Z{5mm}} L]{
	\Table{#2}{#1}{
		  \tableheader Level
		& \tableheader Base Attack Bonus
		& \tableheader Fort Save
		& \tableheader Ref Save
		& \tableheader Will Save
		& \tableheader Special\\
		#3
	}
}

\newcommand{\PrestigeWarriorTable}[2]{
	\MiniWarriorTable[l b{7mm} *{3}{Z{5mm}} L]{#1}{#2}
}

\newcommand{\SpellcasterTable}[4][10]{
	\BigTablePair{#3}{l l *{3}{Z{5mm}} L *{#1}{Z{#2}} }{
		\rowcolor{white}
		\multirow[b]{2}{6mm}{\tableheader Level}
		& \multirow[b]{2}{2cm}{\tableheader Base\\ Attack Bonus}
		& \multirow[t]{3}{5mm}{\tableheader Fort\\ Save}
		& \multirow[t]{2}{5mm}{\tableheader Ref\\ Save}
		& \multirow[t]{3}{5mm}{\tableheader Will\\ Save}
		& \multirow[b]{2}{*}{\tableheader Special}
		& \multicolumn{#1}{c}{\tableheader Spells per day}\\
		\cmidrule[0.5pt]{7-\Sum{6}{#1}}
		#4
	}
}
\newcommand{\Sum}[2]{\number\numexpr #1+#2\relax}
\newcommand{\SpellLevelHeaderRec}[2]{
& \tableheader #1 \ifnum#1<#2 \expandafter\SpellLevelHeaderRec\expandafter{\Sum{#1}{1}}{#2}\fi%
}
\newcommand{\SpellHeader}[2][0]{
&&&&& \SpellLevelHeaderRec{#1}{#2}
}
% \newcommand{\HalfSpellcasterTable}[3][1cm]{
% 	\BigTablePair{#2}{l l *{3}{Z{5mm}} L *{4}{Z{#1}}}{
% 		\rowcolor{white}
% 		\multirow[b]{2}{0.6cm}{\tableheader Level} & \multirow[b]{2}{2cm}{\tableheader Base\\ Attack Bonus} & \multirow[b]{2}{0.6cm}{\tableheader Fort Save} & \multirow[b]{2}{0.6cm}{\tableheader Ref Save} & \multirow[b]{2}{0.6cm}{\tableheader Will Save} & \multirow[b]{2}{*}{\tableheader Special} & \multicolumn{4}{c}{\tableheader Spells per day}\\
% 		\cmidrule[0.5pt]{7-10}
% 		&&&&&& \tableheader 1 & \tableheader 2 & \tableheader 3 & \tableheader 4 \\
% 		#3
% 	}
% }
\newcommand{\PsychicTable}[3][l l *{3}{Z{5mm}} L *{3}{>{\raggedleft\arraybackslash}b{18mm}}]{
	\BigTablePair{#2}{#1}{
		\tableheader Level & \tableheader Base Attack Bonus & \tableheader Fort Save & \tableheader Ref Save & \tableheader Will Save & \tableheader Special & \tableheader Power Points per Day &  \tableheader Powers Known &  \tableheader Disciplines \\
		#3
	}
}

\newcommand{\PrestigeMonkTable}[3][l b{16mm} *{4}{Z{5mm}} Z{9mm} L l]{
	\BigTablePair{#2}{#1}{
		\tableheader Level & \tableheader Base \hskip3em Attack Bonus & \tableheader Fort Save & \tableheader Ref Save & \tableheader Will Save & \tableheader AC Bonus & \tableheader Unarmed Damage & \tableheader Special & \tableheader Manifesting\\
		#3
	}
}

\newcommand{\FeatTable}[3][l]{
	\begin{table*}[ht!]
	\rowcolors{0}{}{TableColor}
	\small
	\begin{tabularx}{\textwidth}{#1 p{4.8cm} X}
		\tableheader #2 Feat & \textold{Prerequisites} & \textold{Benefit}\\
		#3
	\end{tabularx}
	\end{table*}
}

\newcommand{\WeaponTable}[3][]{
	\begin{table*}[t!]
	\ifx&#1&\else\caption{\label{tab:#1}#1}\fi
	\rowcolors{0}{TableColor}{}
	\small
	\begin{tabularx}{\textwidth}{X r{9mm}r{9mm}z{5mm}z{5mm}z{5mm}cz{1.2cm}r{9mm}r{9mm}r{9mm} p{2.1cm}}
		\WeaponHeader{#2}\\
		#3
	\end{tabularx}
	\end{table*}
}
\newcommand{\WeaponHeader}[1]{
		\rowcolor{white}
		& \multicolumn{2}{c}{\tableheader Cost} & \multicolumn{3}{c}{\tableheader Damage} && \multirow[b]{2}{1.1cm}{\centering \tableheader Range Increment}& \multicolumn{3}{c}{\tableheader Weight}&\\
		\cmidrule[0.5pt]{2-6}
		\cmidrule[0.5pt]{9-11}
		\tableheader \footnotesize #1
		& \tableheader S/M
		& \tableheader L
		& \tableheader S
		& \tableheader M
		& \tableheader L
		& \tableheader Critical
		&
		& \tableheader S
		& \tableheader M
		& \tableheader L
		& \tableheader Type
}
\newcommand{\NamedWeaponTable}[2]{\WeaponTable[#1]{#1}{#2}}
\newcommand{\TableSubheader}[1]{\textit{------ #1 ------}}
\newcommand{\WeaponType}[1]{\multicolumn{12}{l}{\TableSubheader{#1}}}
\newcommand{\Projectile}[6]{~ #1&#2&#3&&&&&&#4&#5&#6&}
\newcommand{\InferiorWeapon}[6]{~ #1&#2&#3&$\diamond$&$\diamond$&$\diamond$&&&#4&#5&#6&}

\newcommand{\ItemTable}[2]{
	\Table{#1}{lRR}{
		\tableheader Item & \tableheader Cost & \tableheader Weight\\
		#2
	}
}

\newcommand{\XPTable}[2]{
	\Table{Experience Awards for #1}{X p{3cm}}{
		\tableheader Action & \tableheader XP Award \\
		#2
	}
}

\newenvironment{Formula}[1]
	{
		\centering
		\vskip1em
		{\Large #1}
	}
	{
		\vskip1em
	}
\newenvironment{Formula*}[1]
	{
		\centering
		\vskip1em
		{\Large #1}
		\begin{list}{}{
			\setlength{\itemsep}{.3em}
			\setlength{\rightmargin}{1cm}
			\setlength{\leftmargin}{1cm}
		}
	}
	{
		\end{list}
		\vskip1em
	}


\renewcommand{\arraystretch}{1.1}
\linespread{1.1}
\setcounter{secnumdepth}{0}
\renewcommand{\chaptermark}[1]{ \markboth{\scshape\MakeUppercase{#1}}{} }
\renewcommand{\sectionmark}[1]{ \markright{\scshape#1}{} }
\def\@evenhead{\imfellEnglish\thepage\hfil\leftmark}%
\def\@oddhead{\imfellEnglish{\rightmark}\hfil\thepage}%
\setlength{\dbltextfloatsep}{1mm}
\setlength{\intextsep}{2mm}
\setlength{\textfloatsep}{2mm}
\setlength{\abovecaptionskip}{2mm}
\setlength{\belowcaptionskip}{0mm}
\setlength{\baselineskip}{1mm}
\setlength{\parskip}{.2em}
\setlength{\stripsep}{.5em}
\setlength{\aboverulesep}{0em}
\setlength{\belowrulesep}{0em}
\setlength{\columnsep}{.5cm}
\setlength{\tabcolsep}{0.1cm}

\hyphenpenalty=10000
\clubpenalty=10000
\widowpenalty=1
\displaywidowpenalty=1
\postdisplaypenalty=1
% \tracingmacros
\endinput